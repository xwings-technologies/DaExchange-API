# Websocket Private
In order to receive the data on authenticated channels, the websocket session needs to be authenticated first
by calling authenticate.

All requests need to provide the request time in seconds and must be within 5 seconds of the server time 
or your request will be considered expired and rejected.  To change 5 second expiry, user can set **expiry**
to the desired seconds.

## Authenticate Channel

```javascript
function WebSocketCall() {
    var ws = new WebSocket("wss://ws-api.xxxx.com/ws");

    ws.onopen = function () {
        var authentication = '{"type": "authenticate", "timestamp": 1546495887996, "apiKey": "eccd478408970b5359652052b901c22b", "signature": "2367359ea414228956f50613b30f841c47aa0f47c472c484e56ec20cbdcbbcfb", "passcode": "Password1!"}';
        ws.send(authentication);
    };

    ws.onmessage = function (evt) {
        var received_msg = evt.data;
    };
}
```

> Sample data:

```json
//request
{
  "type": "authenticate",
  "timestamp": 1546495887996,
  "apiKey": "eccd478408970b5359652052b901c22b",
  "signature": "2367359ea414228956f50613b30f841c47aa0f47c472c484e56ec20cbdcbbcfb",
  "passcode": "Password1!"
}
//response
{
  "type": "authenticated",
  "timestamp": 1546495888349
}
```

### Request Fields
Name                   | Type(value)          | Mandatory   | Description
-----------------------| ---------------------|-------------|-----------------------
type                   | authenticate         | M           | 
timestamp              | Long                 | M           | current time in milliseconds from UNIX EPOCH
apiKey                 | String               | M           | 
signature              | String               | M           | Generated by creating a sha256 HMAC using the base64-encoded secret key on the prehash string timestamp + "authenticate" (where + represents string concatenation) and hex-encode the output.
passcode               | String               | M           | 
userMessageId          | Integer              | O           | Unique message id for this websocket session
expiry                 | Integer              | O           | Seconds for the authenticated channel requests to expire

### Response Fields
Name            | Type(value)                    | Mandatory   | Description
----------------| -------------------------------| ------------|--------------------
type            | authenticated                  | M           | Subscribe/Unsubscribe message type
timestamp       | Long                           | M           | When authentication is accepted
userMessageId   | Integer                        | (M)         | Mandatory if userMessageId is provided in the user request



## Order Update Channel

```javascript
function WebSocketCall() {
    var ws = new WebSocket("wss://ws-api.xxxx.com/ws");

    ws.onopen = function () {
        var authentication = '{"type": "authenticate", "timestamp": 1546495887996, "apiKey": "eccd478408970b5359652052b901c22b", "signature": "2367359ea414228956f50613b30f841c47aa0f47c472c484e56ec20cbdcbbcfb", "passcode": "Password1!"}';
        ws.send(authentication);
        var data = '{"channel": "orderUpdate", "type": "subscribe", "instrumentIds": ["ETH/BTC"]}';
        ws.send(data);
    };

    ws.onmessage = function (evt) {
        var received_msg = evt.data;
    };
}
```

> Sample data:

```json
//request
{
  "channel": "orderUpdate",
  "type": "subscribe",
  "instrumentIds": [
    "ETH/BTC"
  ]
}
//response
{
  "type": "subscribed",
  "channel": "orderUpdate",
  "timestamp": 1546498910967,
  "instrumentIds": [
    "ETH/BTC"
  ],
  "openOrders": [
    {
      "selfTradePrevention": "CO",
      "orderType": "LIMIT",
      "side": "BUY",
      "lastModifiedTime": 1546498739286,
      "orderId": "f97800d3-94d3-4176-9be2-0953fbf58aff",
      "instrumentId": "ETH/BTC",
      "fee": "0",
      "clientOrderId": "",
      "orderStatus": "NEW",
      "avgExecutedPrice": "0",
      "totalExecutedSize": "0",
      "postOnly": false,
      "stopPrice": "0",
      "size": "2.56",
      "price": "0.03956",
      "createdTime": 1546498739285,
      "timeInForce": "GTC"
    }
  ]
}
//channel
{
  "type": "orderUpdate",
  "timestamp": 1546498739285,
  "instrumentId": "ETH/BTC",
  "orderId": "f97800d3-94d3-4176-9be2-0953fbf58aff",
  "orderType": "LIMIT",
  "price": "0.03956",
  "size": "2.56",
  "side": "BUY",
  "createdTime": 1546498739285,
  "orderStatus": "CANCELLED",
  "selfTradePrevention": "CO",
  "postLiquidity": true,
  "fee": "0",
  "avgExecutedPrice": "0",
  "cancelReason": "USER_CANCEL"
}
```

### Request Fields
Name                       | Type(value)                    | Mandatory   | Description
---------------------------| -------------------------------| ------------|--------------------
type                       | subscribe                      | M           | Subscribe/Unsubscribe message type
channel                    | orderUpdate                    | M           | 
instrumentIds              | Array of instrumentId Strings  | O           | Subscribe/Unsubscribe all instruments by default
numberOfSnapshotRecords    | Integer                        | O           | Max recent number of open orders returned. All open orders will be returned if not specified.
userMessageId              | Integer                        | O           | Unique message id for this websocket session

### Response Fields
Name            | Type(value)                    | Mandatory   | Description
----------------| -------------------------------| ------------|--------------------
type            | subscribed                     | M           | Subscribe/Unsubscribe message type
channel         | orderUpdate                    | M           | 
timestamp       | Long                           | M           | When the subscription request was accepted
instrumentIds   | Array of instrumentId Strings  | O           | Subscribed/Unsubscribed for all instruments by default
openOrders      | Array of orders Json Fields    | M           | 
userMessageId   | Integer                        | (M)         | Mandatory if userMessageId is provided in the user request

### Channel Fields
Name                 | Type(value)                               | Mandatory   | Description
---------------------| ------------------------------------------| ------------|--------------------
type                 | orderUpdate                               | M           | 
timestamp            | Long                                      | M           | Order update time
orderId              | String                                    | M           | 
instrumentId         | String                                    | M           | 
orderType            | Enum                                      | M           |
price                | DoubleString                              | M           | 
size                 | DoubleString                              | M           | 
side                 | Enum                                      | M           |
createdTime          | Long                                      | M           | 
stopPrice            | DoubleString                              | O           | 
orderStatus          | Enum                                      | M           |
tradeId              | String                                    | O           | Available when the current update is a trade
executedSize         | DoubleString                              | O           | Available when the current update is a trade
executedPrice        | DoubleString                              | O           | Available when the current update is a trade
avgExecutedPrice     | DoubleString                              | O           | Average executed price of all fills in this order 
totalExecutedSize    | DoubleString                              | O           | Total executed size of all fills in this order
postLiquidity        | Boolean                                   | O           | True - order rest in the book initially 
selfTradePrevention  | Enum                                      | M           |
clientOrderId        | String                                    | O           | 
cancelReason         | Enum                                      | O           | Provided when order is cancelled
fee                  | DoubleString                              | O           | Available when the current update is a trade



## Account Update Channel

```javascript
function WebSocketCall() {
    var ws = new WebSocket("wss://ws-api.xxxx.com/ws");

    ws.onopen = function () {
        var authentication = '{"type": "authenticate", "timestamp": 1546495887996, "apiKey": "eccd478408970b5359652052b901c22b", "signature": "2367359ea414228956f50613b30f841c47aa0f47c472c484e56ec20cbdcbbcfb", "passcode": "Password1!"}';
        ws.send(authentication);
        var data = '{"assets": ["ETH"], "channel": "accountUpdate", "type": "subscribe"}';
        ws.send(data);
    };

    ws.onmessage = function (evt) {
        var received_msg = evt.data;
    };
}
```

> Sample data:

```json
//request
{
  "assets": [
    "ETH"
  ],
  "channel": "accountUpdate",
  "type": "subscribe"
}
//response
{
  "type": "subscribed",
  "timestamp": 1546499784,
  "channel": "accountUpdate",
  "assets": [
    "ETH"
  ],
  "balances": [
    {
      "lastModifiedTime": 1544680997349,
      "balance": "97.59900000",
      "available": "97.499",
      "asset": "ETH"
    }
  ]
}
//channel
{
  "type": "accountUpdate",
  "timestamp": 1546499819682,
  "updateReason": "NEW_ORDER",
  "balances": [
    {
      "balance": "97.599",
      "asset": "ETH",
      "availableBalance": "95.199"
    }
  ],
  "referenceId": "2906709c-8155-4fa5-ad3c-aa186d481a1a"
}
```

### Request Fields
Name                         | Type(value)                    | Mandatory   | Description
-----------------------------| -------------------------------| ------------|--------------------
type                         | subscribe                      | M           | Subscribe/Unsubscribe message type
channel                      | accountUpdate                  | M           | 
assets                       | Array of asset Strings         | O           | Subscribe for all currencies by default
userMessageId                | Integer                        | O           | Unique message id for this websocket session

### Response Fields
Name                   | Type(value)                                                                   | Mandatory   | Description
-----------------------| ------------------------------------------------------------------------------| ------------|--------------------
type                   | subscribed                                                                    | M           | Subscribe/Unsubscribe message type
channel                | accountUpdate                                                                 | M           | 
timestamp              | Long                                                                          | M           | When the subscription request is accepted
assets                 | Array of asset Strings                                                        | O           |
balances               | Array of account balances (asset, balance, availableBalance)                  | M           |
userMessageId          | Integer                                                                       | (M)         | Mandatory if userMessageId is provided in the user request

### Channel Fields
Name              | Type(value)                                                               | Mandatory   | Description
------------------| --------------------------------------------------------------------------| ------------|------------------------------------------------------------------------------
type              | accountUpdate                                                             | M           | 
timestamp         | Long                                                                      | M           | Account update time
updateReason      | Enum                                                                      | M           |
balances          | Array of account balances (asset, balance, availableBalance)              | M           |
referenceId       | String                                                                    | M           | NEW_ORDER-orderId; TRADE-tradeId; PENDING_WITHDRAW-withdrawId; TRANSFER-txId



## PNL Update Channel

```javascript
function WebSocketCall() {
    var ws = new WebSocket("wss://ws-api.xxxx.com/ws");

    ws.onopen = function () {
        var authentication = '{"type": "authenticate", "timestamp": 1546495887996, "apiKey": "eccd478408970b5359652052b901c22b", "signature": "2367359ea414228956f50613b30f841c47aa0f47c472c484e56ec20cbdcbbcfb", "passcode": "Password1!"}';
        ws.send(authentication);
        var data = '{"channel": "pnlUpdate", "type": "subscribe"}';
        ws.send(data);
    };

    ws.onmessage = function (evt) {
        var received_msg = evt.data;
    };
}
```

> Sample data:

```json
//request
{
  "channel": "pnlUpdate",
  "type": "subscribe"
}
//response
{
  "type": "subscribed",
  "channel": "pnlUpdate",
  "timestamp": 1546503078686,
  "pnls": [
    {
      "balance": "0.02140386",
      "previousDayPNL": "-1.15",
      "costBasis": "84.43",
      "realizedPNL": "0.00",
      "asset": "BTC",
      "pnlBaseAsset": "USD"
    },
    {
      "balance": "99.63100000",
      "previousDayPNL": "5092.24",
      "costBasis": "10285.78",
      "realizedPNL": "84.66",
      "asset": "ETH",
      "pnlBaseAsset": "USD"
    }
  ]
}
//channel
{
  "type": "pnlUpdate",
  "timestamp": 1546503078686,
  "balance": "99.63100000",
  "previousDayPNL": "5092.24",
  "costBasis": "10285.78",
  "realizedPNL": "84.66",
  "asset": "ETH",
  "pnlBaseAsset": "USD"
}
```

We consider all receives as bought events at the receipt time and all sends as sold events at the sent time.
As such, the numbers here WILL NOT BE ACCURATE if you have sent digital assets to other platforms.

### Request Fields
Name                         | Type(value)                    | Mandatory   | Description
-----------------------------| -------------------------------| ------------|--------------------
type                         | subscribe                      | M           | Subscribe/Unsubscribe message type
channel                      | pnlUpdate                      | M           | 
userMessageId                | Integer                        | O           | Unique message id for this websocket session

### Response Fields
Name                   | Type(value)                                              | Mandatory   | Description
-----------------------| ---------------------------------------------------------| ------------|--------------------
type                   | subscribed                                               | M           | Subscribe/Unsubscribe message type
channel                | pnlUpdate                                                | M           | 
timestamp              | Long                                                     | M           | When the subscription request is accepted
pnls                   | Array of pnl Json                                        | M           | Reference fields in rest GET pnls section
userMessageId          | Integer                                                  | (M)         | Mandatory if userMessageId is provided in the user request

### Channel Fields
Name              | Type(value)                                                          | Mandatory   | Description
------------------|----------------------------------------------------------------------|-------------|-------------------------------------
type              | pnlUpdate                                                            | M           | 
timestamp         | Long                                                                 | M           | PNL update time
asset             | String                                                               | M           |
pnlBaseAsset      | String                                                               | M           | Base asset used to calculate the pnl
balance           | DoubleString                                                         | M           | Current asset balance                                  
costBasis         | DoubleString                                                         | M           | Total ost basis in base asset term
previousDayPNL    | DoubleString                                                         | M           | Previous day pnl in base asset term
realizedPNL       | DoubleString                                                         | M           | Realized pnl in base asset term